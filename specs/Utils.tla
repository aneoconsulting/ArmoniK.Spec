--------------------------------- MODULE Utils ---------------------------------
LOCAL INSTANCE Naturals

(*****************************************************************************)
(* UTILS MODULE                                                              *)
(*---------------------------------------------------------------------------*)
(* This module provides helpers used by the rest of the modules. *)
(*                                                                           *)
(*****************************************************************************)

--------------------------------------------------------------------------------
(*- OPERATORS -*)

BagAdd(B, x) ==
    (*************************************************************************)
    (* Add an element x to bag B.                                            *)
    (* Same as B (+) SetToBag({x}).                                          *)
    (*************************************************************************)
    IF x \in DOMAIN B
    THEN [e \in DOMAIN B |-> IF e = x THEN B[e] + 1 ELSE B[e]]
    ELSE [e \in DOMAIN B \union {x} |-> IF e = x THEN 1 ELSE B[e]]

BagRemove(B, x) ==
    (*************************************************************************)
    (* Remove an element x from bag B.                                       *)
    (* Same as B (-) SetToBag({x}).                                          *)
    (*************************************************************************)
    IF x \in DOMAIN B
    THEN IF B[x] = 1
        THEN [e \in DOMAIN B \ {x} |-> B[e]]
        ELSE [e \in DOMAIN B |-> IF e = x THEN B[e] - 1 ELSE B[e]]
    ELSE B

================================================================================